<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Finco Capital - Dynamic Multi-Purpose Loan Calculator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="../css/calnew.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- EmailJS CDN -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            // Initialize EmailJS with your public key
            emailjs.init("CM3iDUqeWtaSmwhPl");
        })();
    </script>
<style>
   :root {
    --finco-navy: #001A3D;
    --finco-orange: #FF9500;
    --finco-light-blue: #accbff;
    --finco-light-orange: #FFC067;
    --finco-green: #96b85d;
    --gray-50: #f8fafc;
    --gray-100: #f1f5f9;
    --gray-200: #e2e8f0;
    --gray-300: #cbd5e1;
    --gray-400: #94a3b8;
    --gray-500: #64748b;
    --gray-600: #475569;
    --gray-700: #334155;
    --gray-800: #1e293b;
    --gray-900: #0f172a;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif;
    background-color: #fcfcfd;
    color: var(--gray-800);
    line-height: 1.6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* Email Loading Overlay */
.email-loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 26, 61, 0.9);
    z-index: 2000;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: white;
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 5px solid #FF9500;
    border-top: 5px solid transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    margin-top: 20px;
    font-size: 1.2rem;
    color: white;
}

/* Email Success Modal */
.email-success-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    display: none;
    justify-content: center;
    align-items: center;
}

.email-success-content {
    background-color: white;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.5s ease;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.email-success-icon {
    font-size: 60px;
    color: #10b981;
    margin-bottom: 20px;
    animation: bounce 1s;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
    40% {transform: translateY(-20px);}
    60% {transform: translateY(-10px);}
}

.email-success-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #001334;
    margin-bottom: 15px;
}

.email-success-message {
    color: #64748b;
    margin-bottom: 30px;
    line-height: 1.6;
}

.email-success-button {
    padding: 12px 40px;
    background-color: #001334;
    color: #ffbc00;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
}

.email-success-button:hover {
    background-color: #001a3d;
    transform: translateY(-2px);
}

/* Header Styles */
.header {
    background-color: var(--finco-navy);
    color: white;
    padding: 2rem 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.header-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

@media (min-width: 768px) {
    .header-container {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
    }
}

.logo-container {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.finco-logo {
    height: 40px;
    width: auto;
}

@media (min-width: 768px) {
    .finco-logo {
        height: 48px;
    }
}

.vertical-divider {
    height: 40px;
    width: 1px;
    background-color: rgba(148, 163, 184, 0.3);
}

.logo-text {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.logo-title {
    font-size: 14px;
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.4em;
    line-height: 1;
    text-align: center;
    white-space: nowrap;
}

@media (min-width: 768px) {
    .logo-title {
        font-size: 18px;
    }
}

.logo-subtitle {
    font-size: 9px;
    color: var(--finco-orange);
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    margin-top: 0.25rem;
    white-space: nowrap;
}

@media (min-width: 768px) {
    .logo-subtitle {
        font-size: 10px;
    }
}

.header-right {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.empowering-text {
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.3em;
    font-size: 11px;
    text-align: right;
    line-height: 1.3;
}

/* Main Content */
.main-content {
    flex: 1;
    width: 100%;
    padding: 10rem 1rem !important;
}

@media (min-width: 768px) {
    .main-content {
        padding: 6rem 1rem;
    }
}

.screen {
    display: none;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.screen.active {
    display: block;
    opacity: 1;
}

/* Loan Type Selection */
.loan-selector-container {
    max-width: 1000px;
    margin: 0 auto;
    animation: fadeInUp 1s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.hero-section {
    text-align: center;
    margin-bottom: 4rem;
}

.hero-title {
    font-size: 3rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    color: var(--finco-navy);
    line-height: 1;
    text-transform: uppercase;
    letter-spacing: -0.02em;
    margin-bottom: 2rem;
}

@media (min-width: 768px) {
    .hero-title {
        font-size: 5rem;
    }
}

.hero-highlight {
    color: var(--finco-orange);
}

.hero-description {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.hero-text {
    color: var(--gray-500);
    font-size: 1.25rem;
    font-weight: 300;
    max-width: 42rem;
    margin: 0 auto;
    line-height: 1.7;
}

@media (min-width: 768px) {
    .hero-text {
        font-size: 1.5rem;
    }
}

.hero-tagline {
    color: var(--finco-orange);
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    font-size: 0.875rem;
    letter-spacing: 0.35em;
    text-transform: uppercase;
}

.loan-cards-grid {
    display: grid;
    gap: 2rem;
}

@media (min-width: 768px) {
    .loan-cards-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 2rem;
    }
}

.loan-card {
    position: relative;
    padding: 2.5rem;
    border-radius: 2rem;
    border: 1px solid var(--gray-200);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    transition: all 0.5s;
    text-align: left;
    display: flex;
    flex-direction: column;
    min-height: 340px;
    cursor: pointer;
}

.loan-card:hover {
    box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
    border-color: var(--finco-orange);
    transform: translateY(-8px);
}

.loan-tag {
    position: absolute;
    top: 1.5rem;
    right: 2rem;
    font-size: 10px;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: white;
    transition: color 0.3s;
}

.loan-card:hover .loan-tag {
    color: var(--finco-navy);
}

.loan-icon {
    width: 4rem;
    height: 4rem;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin-bottom: 2rem;
    transition: background-color 0.3s;
}

.loan-card:hover .loan-icon {
    background-color: rgba(255, 149, 0, 0.1);
}

.loan-content {
    flex: 1;
}

.loan-title {
    font-size: 1.875rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    color: var(--finco-navy);
    line-height: 1;
    text-transform: uppercase;
    letter-spacing: -0.02em;
    margin-bottom: 0.75rem;
    transition: color 0.3s;
}

.loan-card:hover .loan-title {
    color: var(--finco-orange);
}

.loan-desc {
    color: var(--finco-navy);
    font-size: 1rem;
    font-weight: 300;
    line-height: 1.6;
}

.loan-cta {
    margin-top: auto;
    padding-top: 2rem;
    display: flex;
    align-items: center;
    color: var(--finco-orange);
    font-family: 'League Spartan', sans-serif;
    font-size: 0.875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    opacity: 0;
    transition: opacity 0.3s, transform 0.3s;
}

.loan-card:hover .loan-cta {
    opacity: 1;
}

.arrow {
    margin-left: 0.5rem;
    transition: transform 0.3s;
}

.loan-card:hover .arrow {
    transform: translateX(4px);
}

/* Questionnaire */
.questionnaire-container {
    max-width: 42rem;
    margin: 0 auto;
    animation: slideInRight 0.7s ease;
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.question-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2.5rem;
}

.back-button {
    color: var(--gray-400);
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.3s;
}

.back-button:hover {
    color: var(--finco-navy);
}

.back-arrow {
    font-size: 1.125rem;
    transition: transform 0.3s;
}

.back-button:hover .back-arrow {
    transform: translateX(-4px);
}

.step-counter {
    padding: 0.25rem 0.75rem;
    background-color: var(--gray-100);
    border-radius: 9999px;
    font-size: 10px;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    color: var(--gray-500);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.progress-bar {
    width: 100%;
    height: 6px;
    background-color: var(--gray-100);
    border-radius: 9999px;
    overflow: hidden;
    margin-bottom: 2.5rem;
}

.progress-fill {
    height: 100%;
    background-color: var(--finco-orange);
    width: 25%;
    transition: width 0.7s ease-out;
}

.question-content {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.question-text {
    font-size: 1.875rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 800;
    color: var(--finco-navy);
    line-height: 1.3;
    text-transform: uppercase;
    letter-spacing: -0.02em;
}

@media (min-width: 768px) {
    .question-text {
        font-size: 3rem;
    }
}

.multi-select-note {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--finco-orange);
    background-color: rgba(255, 149, 0, 0.05);
    border: 1px solid rgba(255, 149, 0, 0.1);
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    width: fit-content;
}

.info-icon {
    font-size: 1.125rem;
}

.multi-select-note p {
    font-size: 0.75rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.options-grid {
    display: grid;
    gap: 1rem;
}

.option-button {
    padding: 1.5rem;
    border-radius: 1rem;
    border: 2px solid var(--gray-100);
    text-align: left;
    background-color: white;
    color: var(--gray-600);
    font-size: 1.125rem;
    font-weight: 500;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.option-button:hover {
    border-color: rgba(255, 149, 0, 0.3);
    background-color: var(--gray-50);
}

.option-button.selected {
    background-color: var(--finco-navy);
    border-color: var(--finco-navy);
    color: white;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    transform: translateX(4px);
}

.option-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
    z-index: 10;
}

.checkmark {
    color: var(--finco-orange);
    font-size: 1.25rem;
}

.other-input-container {
    animation: fadeInZoom 0.3s ease;
    display: none;
}

@keyframes fadeInZoom {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.other-input-container.active {
    display: block;
}

.other-input-container label {
    display: block;
    font-size: 0.75rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    color: var(--finco-navy);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
}

#otherText {
    width: 100%;
    padding: 1.5rem;
    border-radius: 1rem;
    border: 2px solid var(--gray-200);
    font-size: 1rem;
    color: var(--gray-700);
    font-weight: 300;
    outline: none;
    transition: border-color 0.3s;
    resize: vertical;
}

#otherText:focus {
    border-color: var(--finco-orange);
}

.confirm-button {
    width: 100%;
    padding: 1.25rem;
    border-radius: 1rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 800;
    font-size: 1.125rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    transition: all 0.3s;
    border: none;
    cursor: pointer;
}

.confirm-button.enabled {
    background-color: var(--finco-orange);
    color: white;
}

.confirm-button.enabled:hover {
    filter: brightness(110%);
    transform: translateY(-2px);
}

.confirm-button:disabled {
    background-color: var(--gray-200);
    color: var(--gray-400);
    box-shadow: none;
    cursor: not-allowed;
}

/* Loading Screen */
.loading-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 8rem 1rem;
    text-align: center;
}

.loading-spinner {
    position: relative;
    width: 6rem;
    height: 6rem;
    margin-bottom: 2rem;
}

.spinner-outer {
    position: absolute;
    inset: 0;
    border: 6px solid var(--finco-orange);
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.spinner-inner {
    position: absolute;
    inset: 0;
    border: 6px solid var(--gray-100);
    border-radius: 50%;
    z-index: -10;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.loading-text {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.loading-title {
    font-size: 1.875rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    color: var(--finco-navy);
    font-style: italic;
    text-transform: uppercase;
    letter-spacing: -0.02em;
}

.loading-subtitle {
    color: var(--gray-400);
    font-family: 'League Spartan', sans-serif;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-size: 0.75rem;
}

/* Results Screen */
.results-container {
    max-width: 1000px;
    margin: 0 auto;
    background-color: white;
    border-radius: 2rem;
    box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    animation: fadeInUp 1s ease;
}

.report-letterhead {
    padding: 2rem 3rem;
    border-bottom: 8px solid var(--finco-navy);
    background-color: var(--gray-50);
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

@media (min-width: 768px) {
    .report-letterhead {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
    }
}

.report-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 0 1rem;
}

.report-header-tag {
    color: var(--finco-orange);
    font-size: 0.75rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.4em;
    margin-bottom: 1rem;
}

.report-title {
    font-size: 2.25rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 800;
    color: var(--finco-navy);
    font-style: italic;
    line-height: 1.2;
    text-transform: uppercase;
    margin-bottom: 1rem;
}

@media (min-width: 768px) {
    .report-title {
        font-size: 3rem;
    }
}

.report-subtitle {
    color: var(--gray-500);
    font-size: 1.125rem;
    font-weight: 300;
    margin-bottom: 1rem;
}

.report-note {
    color: var(--gray-400);
    font-size: 0.875rem;
    font-style: italic;
    max-width: 42rem;
    margin: 0 auto;
}

.report-content {
    padding: 2rem 3rem 3rem;
}

@media (min-width: 768px) {
    .report-content {
        padding: 3rem;
    }
}

.report-section {
    padding: 2rem;
    border-radius: 2rem;
    border: 1px solid var(--gray-100);
    margin-bottom: 1.5rem;
    transition: all 0.3s;
}

@media (min-width: 768px) {
    .report-section {
        padding: 2.5rem;
    }
}

.section-title {
    font-size: 1.25rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1.5rem;
}

.section-content {
    font-size: 1.125rem;
    line-height: 1.7;
}

.section-content ul {
    list-style: none;
    padding: 0;
}

.section-content li {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
}

.bullet {
    margin-top: 0.5rem;
}

.section-cta {
    background-color: rgba(255, 149, 0, 0.05);
    border: 2px solid var(--finco-orange);
    border-radius: 2rem;
    padding: 2rem;
    text-align: center;
    margin: 2rem 0;
}

@media (min-width: 768px) {
    .section-cta {
        padding: 2.5rem;
    }
}

.cta-title {
    font-size: 1.5rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 800;
    color: var(--finco-navy);
    text-transform: uppercase;
    margin-bottom: 1.5rem;
}

.cta-content {
    color: var(--gray-600);
    font-size: 1.125rem;
    max-width: 36rem;
    margin: 0 auto;
}

.cta-content a {
    color: var(--finco-navy);
    font-weight: 700;
    text-decoration: none;
}

.cta-content a:hover {
    text-decoration: underline;
    text-underline-offset: 4px;
}

.cta-emphasis {
    color: var(--finco-navy);
    font-weight: 700;
    font-style: italic;
    font-size: 1rem;
    border-top: 1px solid rgba(255, 149, 0, 0.2);
    padding-top: 1rem;
    margin-top: 1rem;
}

.reference-note {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 0.5rem;
}

.reference-text {
    color: var(--gray-400);
    font-size: 0.75rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.disclaimer-section {
    background-color: var(--gray-50);
    border-radius: 1rem;
    padding: 2rem;
    border: 1px solid var(--gray-200);
    margin-top: 2rem;
}

.disclaimer-title {
    color: var(--gray-900);
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-size: 0.75rem;
    margin-bottom: 1rem;
}

.disclaimer-text {
    font-size: 0.75rem;
    line-height: 1.7;
    font-style: italic;
    color: var(--gray-500);
    font-weight: 300;
    margin-bottom: 1rem;
}

.disclaimer-footer {
    font-size: 10px;
    color: var(--gray-400);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
}

.results-actions {
    max-width: 1000px;
    margin: 3rem auto 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
    padding-top: 2rem;
}

@media (min-width: 768px) {
    .results-actions {
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 1rem;
    }
}

.action-button {
    padding: 1rem 1.5rem;
    border-radius: 1rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 800;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    transition: all 0.3s;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.download-btn {
    background-color: var(--finco-orange);
    color: white;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
}

.download-btn:hover {
    filter: brightness(110%);
}

.download-btn:disabled {
    opacity: 0.7;
    cursor: wait;
}

.primary-btn {
    background-color: var(--finco-navy);
    color: white;
    padding: 1.25rem 2.5rem;
    box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
}

.primary-btn:hover {
    background-color: var(--gray-800);
}

.secondary-btn {
    background-color: white;
    color: var(--finco-navy);
    border: 2px solid var(--gray-200);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.secondary-btn:hover {
    background-color: var(--gray-50);
}

.btn-icon {
    font-size: 1.125rem;
}

/* Modal */
.modal-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 26, 61, 0.8);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    overflow-y: auto;
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background-color: white;
    width: 100%;
    max-width: 42rem;
    border-radius: 2.5rem;
    box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    position: relative;
    animation: modalIn 0.3s ease;
    margin: auto;
}

@keyframes modalIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.modal-close {
    position: absolute;
    top: 1.5rem;
    right: 2rem;
    color: var(--gray-400);
    font-size: 2rem;
    font-weight: bold;
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.3s;
    line-height: 1;
    padding: 0;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    color: var(--finco-navy);
}

.modal-header {
    background-color: var(--gray-50);
    padding: 2rem;
    border-bottom: 1px solid var(--gray-100);
}

.modal-logo-svg {
    height: 40px;
    width: auto;
    margin-bottom: 1rem;
}

.modal-title {
    font-size: 1.875rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 800;
    color: var(--finco-navy);
    text-transform: uppercase;
    letter-spacing: -0.02em;
}

.modal-subtitle {
    color: var(--gray-500);
    font-size: 0.75rem;
    margin-top: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
}

.modal-body {
    padding: 2rem;
}

@media (min-width: 768px) {
    .modal-body {
        padding: 2.5rem;
    }
}

.form-step {
    display: none;
}

.form-step.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.form-grid {
    display: grid;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

@media (min-width: 768px) {
    .form-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-group label {
    font-size: 10px;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    color: var(--finco-navy);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.form-group input,
.form-group textarea,
.form-group select {
    padding: 1rem;
    background-color: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 0.75rem;
    font-size: 1rem;
    color: var(--gray-700);
    outline: none;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    border-color: var(--finco-orange);
}

.form-note {
    background-color: rgba(255, 149, 0, 0.05);
    border: 1px solid rgba(255, 149, 0, 0.2);
    padding: 1rem;
    border-radius: 0.75rem;
    margin: 1.5rem 0;
}

.form-note p {
    color: var(--finco-navy);
    font-size: 0.75rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    text-align: center;
    font-style: italic;
}

.form-submit {
    width: 100%;
    padding: 1.25rem;
    background-color: var(--finco-navy);
    color: white;
    border-radius: 1rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
}

.form-submit:hover {
    background-color: var(--gray-800);
}

.verification-header {
    text-align: center;
    margin-bottom: 2rem;
}

.verification-header h3 {
    font-size: 1.5rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    color: var(--finco-navy);
    text-transform: uppercase;
    margin-bottom: 0.5rem;
}

.verification-header p {
    color: var(--gray-500);
    font-size: 0.875rem;
}

.verification-inputs {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.otp-group {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.otp-group label {
    font-size: 10px;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    color: var(--finco-navy);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    text-align: center;
}

.otp-input {
    width: 8rem;
    margin: 0 auto;
    padding: 1rem;
    background-color: var(--gray-50);
    border: 2px solid var(--gray-200);
    border-radius: 0.75rem;
    text-align: center;
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    font-size: 1.25rem;
    letter-spacing: 0.5em;
    color: var(--gray-700);
    outline: none;
    transition: border-color 0.3s;
}

.otp-input:focus {
    border-color: var(--finco-orange);
}

.verify-btn {
    width: 100%;
    padding: 1.25rem;
    background-color: var(--finco-orange);
    color: white;
    border-radius: 1rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    border: none;
    cursor: pointer;
    transition: filter 0.3s;
}

.verify-btn:hover {
    filter: brightness(110%);
}

.verify-btn:disabled {
    opacity: 0.7;
    cursor: wait;
}

.success-icon {
    width: 5rem;
    height: 5rem;
    background-color: #d1fae5;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: #059669;
    margin: 0 auto 2rem;
}

.success-content {
    text-align: center;
    margin-bottom: 2rem;
}

.success-content h3 {
    font-size: 1.875rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    color: var(--finco-navy);
    text-transform: uppercase;
    margin-bottom: 0.75rem;
}

.success-content p {
    color: var(--gray-600);
    font-size: 1.125rem;
    max-width: 24rem;
    margin: 0 auto;
    line-height: 1.7;
}

.success-btn {
    width: 100%;
    padding: 1.25rem;
    background-color: var(--finco-navy);
    color: white;
    border-radius: 1rem;
    font-family: 'League Spartan', sans-serif;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
}

.success-btn:hover {
    background-color: var(--gray-800);
}

/* Footer */
.footer {
    padding: 3rem 1.5rem;
    background-color: white;
    border-top: 1px solid var(--gray-100);
}

.footer-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 2rem;
    align-items: center;
}

@media (min-width: 768px) {
    .footer-container {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
    }
}

.footer-logo-svg {
    height: 40px;
    width: auto;
}

.footer-text {
    color: var(--gray-400);
    font-size: 10px;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    text-align: center;
}

@media (min-width: 768px) {
    .footer-text {
        text-align: right;
    }
}

/* Utility Classes */
.text-bold {
    font-weight: 800;
}

.text-finco-navy {
    color: var(--finco-navy);
}

.text-finco-orange {
    color: var(--finco-orange);
}

/* Scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--gray-100);
}

::-webkit-scrollbar-thumb {
    background: var(--gray-300);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--gray-400);
}

/* PDF Generation Fix Styles */
.pdf-generation-fix {
    position: fixed;
    top: -9999px;
    left: -9999px;
    width: 210mm; /* A4 width */
    min-height: 297mm; /* A4 height */
    background-color: white;
    z-index: -9999;
    opacity: 0;
    visibility: hidden;
}

.pdf-report-content {
    width: 100%;
    height: auto;
    background-color: white;
    color: #000000;
    font-family: 'League Spartan', 'Arial', sans-serif;
}

.pdf-report-content * {
    color: #000000 !important;
    background-color: white !important;
    box-shadow: none !important;
    border-color: #000000 !important;
}

.pdf-report-content .report-section {
    border: 1px solid #000000;
    margin-bottom: 20px;
}

.pdf-report-content .section-title {
    color: #001A3D !important;
}

.pdf-report-content .report-header-tag {
    color: #FF9500 !important;
}

.pdf-report-content .report-title {
    color: #001A3D !important;
}
</style>
</head>
<body>

<!-- Email Loading Overlay -->
<div id="emailLoading" class="email-loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Sending your enquiry...</div>
</div>

<!-- Email Success Modal -->
<div id="emailSuccessModal" class="email-success-modal">
    <div class="email-success-content">
        <div class="email-success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h2 class="email-success-title">Thank You!</h2>
        <p class="email-success-message">
            Thank you for booking your Free Expert Strategy Session! FINCO CAPITAL will contact you shortly to discuss your case.
        </p>
        <button id="emailSuccessButton" class="email-success-button">OK</button>
    </div>
</div>

<!-- header container - dynamically loaded -->
<div id="header-container"></div>

<main class="main-content">
    <!-- Loan Type Selection Screen -->
    <div id="loanTypeScreen" class="screen active">
        <div class="loan-selector-container">
            <div class="hero-section">
                <h1 class="hero-title">Identify Your <br><span class="hero-highlight">Strategic Pathway</span></h1>
                <div class="hero-description">
                    <p class="hero-text">Select your lending focus to begin a framework-driven classification of your case.</p>
                    <p class="hero-tagline">FINCO CAPITAL: Financial Confidence. Unlocked.</p>
                </div>
            </div>
            
            <div class="loan-cards-grid">
                <div class="loan-card" data-loan-type="HOME" style="background-color: #accbff;">
                    <div class="loan-tag">Personal</div>
                    <div class="loan-icon">üè†</div>
                    <div class="loan-content">
                        <h3 class="loan-title">Home Loan</h3>
                        <p class="loan-desc">Classification for buying, refinancing, or residential portfolio building.</p>
                    </div>
                    <div class="loan-cta">
                        Begin Analysis <span class="arrow">‚Üí</span>
                    </div>
                </div>
                
                <div class="loan-card" data-loan-type="COMMERCIAL" style="background-color: #FFC067;">
                    <div class="loan-tag">Corporate</div>
                    <div class="loan-icon">üè¢</div>
                    <div class="loan-content">
                        <h3 class="loan-title">Commercial Lending</h3>
                        <p class="loan-desc">Complex business debt, cashflow optimisation, and asset-backed growth.</p>
                    </div>
                    <div class="loan-cta">
                        Begin Analysis <span class="arrow">‚Üí</span>
                    </div>
                </div>
                
                <div class="loan-card" data-loan-type="SMSF" style="background-color: #96b85d;">
                    <div class="loan-tag">Trust</div>
                    <div class="loan-icon">üìà</div>
                    <div class="loan-content">
                        <h3 class="loan-title">SMSF LRBA</h3>
                        <p class="loan-desc">Specialised strategy for lending within a Self-Managed Super Fund.</p>
                    </div>
                    <div class="loan-cta">
                        Begin Analysis <span class="arrow">‚Üí</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Questionnaire Screen -->
    <div id="questionnaireScreen" class="screen">
        <div class="questionnaire-container">
            <div class="question-header">
                <button id="backButton" class="back-button">
                    <span class="back-arrow">‚Üê</span> Return to Previous
                </button>
                <span class="step-counter">Step <span id="currentStep">1</span> of 4</span>
            </div>

            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>

            <div class="question-content">
                <h2 id="questionText" class="question-text"></h2>
                
                <div id="multiSelectNote" class="multi-select-note">
                    <span class="info-icon">‚ìò</span>
                    <p>Select up to two that apply</p>
                </div>
                
                <div id="optionsContainer" class="options-grid">
                    <!-- Options will be dynamically inserted here -->
                </div>
                
                <div id="otherInputContainer" class="other-input-container">
                    <label>Please provide more details:</label>
                    <textarea id="otherText" rows="4" placeholder="Tell us a bit more about your situation..."></textarea>
                </div>
                
                <button id="confirmButton" class="confirm-button">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="screen">
        <div class="loading-container">
            <div class="loading-spinner">
                <div class="spinner-outer"></div>
                <div class="spinner-inner"></div>
            </div>
            <div class="loading-text">
                <h3 class="loading-title">Analysing Case Parameters...</h3>
                <p class="loading-subtitle">Mapping results to FINCO strategy frameworks</p>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="resultsScreen" class="screen">
        <div class="results-container">
            <!-- Report will be dynamically inserted here -->
        </div>
        
        <div class="results-actions">
            <button id="downloadPDF" class="action-button download-btn">
                <span class="btn-icon">üìÑ</span> Download Report (PDF)
            </button>
            
            <button id="bookSession" class="action-button primary-btn">
                Book a Free Expert Strategy Session
            </button>
            
            <button id="resetAnalysis" class="action-button secondary-btn">
                Reset Analysis
            </button>
        </div>
    </div>
</main>

<!-- PDF Generation Container (Hidden) -->
<div id="pdfGenerationContainer" class="pdf-generation-fix">
    <div id="pdfReportContent" class="pdf-report-content">
        <!-- PDF content will be inserted here -->
    </div>
</div>

<!-- Strategy Session Modal -->
<div id="sessionModal" class="modal-overlay">
    <div class="modal-content">
        <button id="closeModal" class="modal-close">&times;</button>
        
        <div class="modal-header">
            <div class="modal-logo">
                <svg viewBox="0 0 500 150" class="modal-logo-svg" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 30C20 20 80 15 80 15C80 15 140 20 140 30V80C140 110 80 140 80 140C80 140 20 110 20 80V30Z" fill="#001A3D" />
                    <path d="M25 35C25 28 80 20 80 20C80 20 135 28 135 35V80C135 105 80 135 80 135C80 135 25 105 25 80V35Z" stroke="#FF9500" stroke-width="3" />
                    <circle cx="80" cy="55" r="24" stroke="#FF9500" stroke-width="6" />
                    <rect x="76" y="75" width="8" height="48" fill="#FF9500" />
                    <rect x="84" y="98" width="14" height="6" fill="#FF9500" />
                    <rect x="84" y="112" width="14" height="6" fill="#FF9500" />
                    <text x="88" y="130" fill="#FF9500" style="font: 800 24px 'League Spartan', sans-serif">$</text>
                    <text x="80" y="63" text-anchor="middle" fill="#FF9500" style="font: bold 20px 'League Spartan', sans-serif; letter-spacing: -1px">FC</text>
                    <text x="170" y="85" fill="#001A3D" style="font: 800 78px 'League Spartan', sans-serif; letter-spacing: -4px">FINC<tspan fill="#FF9500">O</tspan></text>
                    <text x="170" y="122" fill="#001A3D" style="font: 700 24px 'League Spartan', sans-serif; letter-spacing: 10px; text-transform: uppercase">CAPITAL</text>
                </svg>
            </div>
            <h2 class="modal-title">Book Strategy Session</h2>
            <p class="modal-subtitle">Free Expert Consultation</p>
        </div>

        <div class="modal-body">
            <div id="formStep" class="form-step active">
                <form id="bookingForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="fullName" required placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label>Mobile Number *</label>
                            <input type="tel" id="mobile" required placeholder="0400 000 000">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address *</label>
                        <input type="email" id="email" required placeholder="john@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Why are you requesting this session? *</label>
                        <textarea id="briefNote" rows="2" required placeholder="Brief explanation..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Preferred Call-back Time *</label>
                        <select id="preferredTime" required>
                            <option value="">Select a slot</option>
                            <option value="Mon, 9:00 AM - 10:00 AM">Mon, 9:00 AM - 10:00 AM</option>
                            <option value="Mon, 2:00 PM - 3:00 PM">Mon, 2:00 PM - 3:00 PM</option>
                            <option value="Tue, 10:00 AM - 11:00 AM">Tue, 10:00 AM - 11:00 AM</option>
                            <option value="Wed, 1:00 PM - 2:00 PM">Wed, 1:00 PM - 2:00 PM</option>
                            <option value="Thu, 3:00 PM - 4:00 PM">Thu, 3:00 PM - 4:00 PM</option>
                            <option value="Fri, 11:00 AM - 12:00 PM">Fri, 11:00 AM - 12:00 PM</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Additional Comments (Optional)</label>
                        <textarea id="comments" rows="2" placeholder="Any focus areas or context..."></textarea>
                    </div>
                    
                    <div class="form-note">
                        <p>"Your personalised report will be emailed to you in PDF format."</p>
                    </div>
                    
                    <button type="submit" class="form-submit">Complete Booking</button>
                </form>
            </div>
            

            
            <div id="successStep" class="form-step">
                <div class="success-icon">‚úì</div>
                <div class="success-content">
                    <h3>Booking Confirmed</h3>
                    <p>Thank you for booking your Free Expert Strategy Session. Your personalised report is on its way to your email.</p>
                </div>
                <button id="returnToReport" class="success-btn">Return to Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<span id="currentYear" style="display: none;"></span>

<!-- JavaScript Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<!-- Main JavaScript -->
<script>
// Application State
const AppState = {
    loanType: null,
    step: 0,
    answers: [],
    isProcessing: false,
    result: null,
    selectedLoanType: null,
    bookingFormData: null
};

// EmailJS Configuration
const EMAILJS_CONFIG = {
    SERVICE_ID: 'service_y3uxg4s',
    TEMPLATE_ID: 'template_qfz4nf6',
    PUBLIC_KEY: 'CM3iDUqeWtaSmwhPl'
};

// Questions Data
const QUESTIONS = {
    HOME: [
        {
            id: 'h1',
            text: 'Where are you in your property journey right now?',
            options: [
                'Buying my first home',
                'Buying or upgrading',
                'Buying before selling',
                'Refinancing',
                'Managing repayments',
                'Investor (Reviewing investment portfolio)',
                'Not sure',
                'Other'
            ]
        },
        {
            id: 'h2',
            text: 'What are you mainly looking to do right now?',
            options: [
                { label: 'Buy my first home', excludeIfSelected: ['Refinancing', 'Managing repayments', 'Buying or upgrading', 'Buying before selling', 'Investor (Reviewing investment portfolio)'] },
                { label: 'Buy or upgrade', excludeIfSelected: ['Refinancing', 'Managing repayments', 'Buying my first home', 'Investor (Reviewing investment portfolio)'] },
                { label: 'Improve my current loan', excludeIfSelected: ['Buying my first home', 'Buying or upgrading', 'Buying before selling'] },
                { label: 'Expand my portfolio (New acquisition)', excludeIfSelected: ['Buying my first home', 'Buying or upgrading', 'Buying before selling', 'Refinancing', 'Managing repayments'] },
                { label: 'Consolidate or reduce properties', excludeIfSelected: ['Buying my first home', 'Buying or upgrading', 'Buying before selling', 'Refinancing', 'Managing repayments'] },
                { label: 'Increase borrowing power', excludeIfSelected: [] },
                { label: 'Manage repayments or future rate changes', excludeIfSelected: ['Buying my first home'] },
                { label: 'Prepare for a future move or investment', excludeIfSelected: [] },
                { label: 'Other' }
            ],
            multiSelect: true
        },
        {
            id: 'h3',
            text: 'Why is getting this right important for you now?',
            options: [
                'I want confidence before deciding',
                'I want to avoid financial stress',
                'Timing matters',
                'I want guidance',
                'I need to optimize my tax or cashflow structure',
                'Not sure',
                'Other'
            ]
        },
        {
            id: 'h4',
            text: 'After this step, what would success look like?',
            options: [
                'Owning comfortably',
                'Stable repayments',
                'Flexibility for the future',
                'Ready for the next step',
                'A more efficient and scalable portfolio',
                'Haven\'t thought that far yet',
                'Other'
            ]
        }
    ],
    COMMERCIAL: [
        {
            id: 'c1',
            text: 'Which option best describes your business and how income comes in?',
            options: [
                'Contract or project-based',
                'Seasonal or cyclical',
                'Retail or trade',
                'Professional or advisory',
                'Asset-heavy (property or equipment)',
                'Growth-led or asset-light',
                'Other'
            ]
        },
        {
            id: 'c2',
            text: 'What are you hoping this loan or funding will help you with?',
            options: [
                { label: 'Reducing financial pressure', excludeIfSelected: ['Growth-led or asset-light'] },
                { label: 'Reviewing or restructuring a loan', excludeIfSelected: [] },
                { label: 'Being declined by a bank', excludeIfSelected: [] },
                { label: 'Fixed-rate ending or loan review', excludeIfSelected: [] },
                { label: 'Accessing equity', excludeIfSelected: [] },
                { label: 'Business growth or acquisition', excludeIfSelected: ['Reducing financial pressure'] },
                { label: 'Other', excludeIfSelected: [] }
            ],
            multiSelect: true
        },
        {
            id: 'c3',
            text: 'If nothing changed over the next 6‚Äì12 months, what would that mean?',
            options: [
                'More financial pressure',
                'Missed growth opportunities',
                'Forced decisions later',
                'Not urgent, but want clarity',
                'Other'
            ]
        },
        {
            id: 'c4',
            text: 'How do you expect this loan to be managed over time?',
            options: [
                'Repaid from business cashflow',
                'Reviewed or refinanced later',
                'Paid down through asset sale',
                'Part of a growth or restructure plan',
                'Other'
            ]
        }
    ],
    SMSF: [
        {
            id: 's1',
            text: 'Which option best describes your SMSF\'s current position?',
            options: [
                'Newly established SMSF',
                'Established SMSF, no property yet',
                'SMSF owns property with a loan',
                'SMSF owns property outright',
                'Considering refinance or restructure',
                'Not sure',
                'Other'
            ]
        },
        {
            id: 's2',
            text: 'What prompted you to explore an SMSF loan now?',
            options: [
                { label: 'Purchase property', excludeIfSelected: ['SMSF owns property with a loan', 'Considering refinance or restructure'] },
                { label: 'Improve cashflow inside the SMSF', excludeIfSelected: ['Newly established SMSF'] },
                { label: 'Refinance or review an SMSF loan', excludeIfSelected: ['Newly established SMSF', 'Established SMSF, no property yet'] },
                { label: 'Fixed rate ending', excludeIfSelected: ['Newly established SMSF', 'Established SMSF, no property yet'] },
                { label: 'Unlock equity', excludeIfSelected: ['Newly established SMSF'] },
                { label: 'Align with retirement planning', excludeIfSelected: [] },
                { label: 'Other' }
            ],
            multiSelect: true
        },
        {
            id: 's3',
            text: 'If this isn\'t addressed in the next 6‚Äì12 months, what\'s the impact?',
            options: [
                'Reduced cashflow or contribution pressure',
                'Missed investment opportunities',
                'Increased compliance risk',
                'Forced decisions later',
                'Not urgent, want clarity',
                'Other'
            ]
        },
        {
            id: 's4',
            text: 'How do you expect this SMSF loan or property to be managed over time?',
            options: [
                'Gradually paid down',
                'Refinance later',
                'Held long-term for retirement',
                'Sold as part of strategy',
                'Haven\'t thought about it yet',
                'Other'
            ]
        }
    ]
};

// DOM Elements
const screens = {
    loanType: document.getElementById('loanTypeScreen'),
    questionnaire: document.getElementById('questionnaireScreen'),
    loading: document.getElementById('loadingScreen'),
    results: document.getElementById('resultsScreen')
};

const loanCards = document.querySelectorAll('.loan-card');
const backButton = document.getElementById('backButton');
const currentStepElement = document.getElementById('currentStep');
const progressFill = document.getElementById('progressFill');
const questionText = document.getElementById('questionText');
const multiSelectNote = document.getElementById('multiSelectNote');
const optionsContainer = document.getElementById('optionsContainer');
const otherInputContainer = document.getElementById('otherInputContainer');
const otherText = document.getElementById('otherText');
const confirmButton = document.getElementById('confirmButton');
const downloadPDF = document.getElementById('downloadPDF');
const bookSession = document.getElementById('bookSession');
const resetAnalysis = document.getElementById('resetAnalysis');
const sessionModal = document.getElementById('sessionModal');
const closeModal = document.getElementById('closeModal');
const bookingForm = document.getElementById('bookingForm');
const formStep = document.getElementById('formStep');
const successStep = document.getElementById('successStep');
const returnToReport = document.getElementById('returnToReport');
const currentYear = document.getElementById('currentYear');
const pdfGenerationContainer = document.getElementById('pdfGenerationContainer');
const pdfReportContent = document.getElementById('pdfReportContent');
const emailLoading = document.getElementById('emailLoading');
const emailSuccessModal = document.getElementById('emailSuccessModal');
const emailSuccessButton = document.getElementById('emailSuccessButton');

// Current selection state for questionnaire
let currentSelectedOptions = [];
let currentMultiSelect = false;
let currentQuestionData = null;

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    // Set current year in footer
    currentYear.textContent = new Date().getFullYear();
    
    // Initialize event listeners
    initializeEventListeners();
    
    // Show initial screen
    showScreen('loanType');
});

function initializeEventListeners() {
    // Loan type selection
    loanCards.forEach(card => {
        card.addEventListener('click', () => {
            const loanType = card.getAttribute('data-loan-type');
            selectLoanType(loanType);
        });
    });
    
    // Back button
    backButton.addEventListener('click', goBack);
    
    // Confirm button
    confirmButton.addEventListener('click', handleConfirm);
    
    // Other text input
    otherText.addEventListener('input', updateConfirmButton);
    
    // Results actions
    downloadPDF.addEventListener('click', handleDownloadPDF);
    bookSession.addEventListener('click', () => {
        sessionModal.classList.add('active');
    });
    resetAnalysis.addEventListener('click', resetApp);
    
    // Modal actions
    closeModal.addEventListener('click', () => {
        sessionModal.classList.remove('active');
    });
    
    // Close modal when clicking outside
    sessionModal.addEventListener('click', (e) => {
        if (e.target === sessionModal) {
            sessionModal.classList.remove('active');
        }
    });
    
    // Booking form
    bookingForm.addEventListener('submit', handleFormSubmit);
    

    
    // Return to report
    returnToReport.addEventListener('click', () => {
        sessionModal.classList.remove('active');
    });
    

    
    // Email success modal
    emailSuccessButton.addEventListener('click', () => {
        emailSuccessModal.style.display = 'none';
        sessionModal.classList.remove('active');
    });
}

function selectLoanType(loanType) {
    AppState.loanType = loanType;
    AppState.step = 0;
    AppState.answers = [];
    AppState.selectedLoanType = loanType;
    
    showScreen('questionnaire');
    loadQuestion();
    scrollToTop();
}

function showScreen(screenName) {
    // Hide all screens
    Object.values(screens).forEach(screen => {
        screen.classList.remove('active');
    });
    
    // Show selected screen
    if (screens[screenName]) {
        screens[screenName].classList.add('active');
    }
}

function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function loadQuestion() {
    const questions = QUESTIONS[AppState.loanType];
    const currentQuestion = questions[AppState.step];
    currentQuestionData = currentQuestion;
    
    // Update UI
    currentStepElement.textContent = AppState.step + 1;
    progressFill.style.width = `${((AppState.step + 1) / questions.length) * 100}%`;
    questionText.textContent = currentQuestion.text;
    
    // Show/hide multi-select note
    if (currentQuestion.multiSelect) {
        multiSelectNote.style.display = 'flex';
        currentMultiSelect = true;
        confirmButton.textContent = AppState.step === 3 ? 'Finalise Strategy' : 'Continue';
    } else {
        multiSelectNote.style.display = 'none';
        currentMultiSelect = false;
        confirmButton.textContent = 'Continue';
    }
    
    // Get filtered options
    const filteredOptions = getFilteredOptions(currentQuestion);
    
    // Clear options
    optionsContainer.innerHTML = '';
    currentSelectedOptions = [];
    
    // Add options
    filteredOptions.forEach(option => {
        const label = typeof option === 'string' ? option : option.label;
        const optionElement = document.createElement('button');
        optionElement.className = 'option-button';
        optionElement.innerHTML = `
            <div class="option-content">
                <span>${label}</span>
                <span class="checkmark">‚úì</span>
            </div>
        `;
        
        optionElement.addEventListener('click', () => {
            handleOptionClick(label, optionElement);
        });
        
        optionsContainer.appendChild(optionElement);
    });
    
    // Reset other input
    otherInputContainer.classList.remove('active');
    otherText.value = '';
    
    // Update confirm button state
    updateConfirmButton();
}

function getFilteredOptions(question) {
    const allSelectedAnswers = AppState.answers.flatMap(answer => answer.answers);
    
    return question.options.filter(opt => {
        const option = typeof opt === 'string' ? { label: opt } : opt;
        if (!option.excludeIfSelected || option.excludeIfSelected.length === 0) return true;
        
        const isExcluded = option.excludeIfSelected.some(exclusion => 
            allSelectedAnswers.includes(exclusion)
        );
        return !isExcluded;
    });
}

function handleOptionClick(label, element) {
    if (currentMultiSelect) {
        if (currentSelectedOptions.includes(label)) {
            // Deselect
            currentSelectedOptions = currentSelectedOptions.filter(opt => opt !== label);
            element.classList.remove('selected');
        } else {
            // Select (max 2)
            if (currentSelectedOptions.length < 2) {
                currentSelectedOptions.push(label);
                element.classList.add('selected');
            }
        }
        
        // Handle "Other" selection
        if (label === 'Other') {
            if (currentSelectedOptions.includes('Other')) {
                otherInputContainer.classList.add('active');
            } else {
                otherInputContainer.classList.remove('active');
            }
        } else {
            // If selecting a non-other option, deselect "Other"
            const otherIndex = currentSelectedOptions.indexOf('Other');
            if (otherIndex > -1) {
                currentSelectedOptions.splice(otherIndex, 1);
                document.querySelectorAll('.option-button').forEach(btn => {
                    if (btn.textContent.includes('Other')) {
                        btn.classList.remove('selected');
                    }
                });
                otherInputContainer.classList.remove('active');
            }
        }
    } else {
        // Single select
        if (label === 'Other') {
            currentSelectedOptions = ['Other'];
            otherInputContainer.classList.add('active');
            
            // Deselect all other options
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
        } else {
            // Directly proceed for single select (non-other)
            handleNext([label]);
            return;
        }
    }
    
    updateConfirmButton();
}

function updateConfirmButton() {
    const hasSelection = currentSelectedOptions.length > 0;
    const hasOtherText = !currentSelectedOptions.includes('Other') || 
                        (currentSelectedOptions.includes('Other') && otherText.value.trim() !== '');
    
    if (hasSelection && hasOtherText) {
        confirmButton.classList.add('enabled');
        confirmButton.disabled = false;
    } else {
        confirmButton.classList.remove('enabled');
        confirmButton.disabled = true;
    }
}

function handleConfirm() {
    if (currentSelectedOptions.length === 0) return;
    
    const finalAnswers = currentSelectedOptions.map(opt => {
        if (opt === 'Other' && otherText.value.trim() !== '') {
            return `Other: ${otherText.value.trim()}`;
        }
        return opt;
    });
    
    handleNext(finalAnswers);
}

function handleNext(selectedAnswers) {
    const questions = QUESTIONS[AppState.loanType];
    const currentQuestion = questions[AppState.step];
    
    // Save answer
    AppState.answers.push({
        questionId: currentQuestion.id,
        questionText: currentQuestion.text,
        answers: selectedAnswers
    });
    
    // Check if we should proceed to next question or process result
    if (AppState.step < questions.length - 1) {
        AppState.step++;
        loadQuestion();
        scrollToTop();
    } else {
        // Process result
        processResult();
    }
}

function goBack() {
    if (AppState.step === 0) {
        // Return to loan type selection
        AppState.loanType = null;
        AppState.step = 0;
        AppState.answers = [];
        showScreen('loanType');
    } else {
        // Go to previous question
        AppState.step--;
        AppState.answers.pop();
        loadQuestion();
    }
    scrollToTop();
}

async function processResult() {
    showScreen('loading');
    
    // Simulate API call with setTimeout
    setTimeout(() => {
        const result = generateMockResult();
        AppState.result = result;
        showScreen('results');
        renderResult(result);
        scrollToTop();
    }, 2000);
}

function generateMockResult() {
    const loanType = AppState.selectedLoanType;
    const refNumber = generateReferenceNumber();
    
    let caseTitle, sections;
    
    switch(loanType) {
        case 'HOME':
            caseTitle = "# The Strategic Refinance Case";
            sections = [
                {
                    title: "What this means for you",
                    content: "Your responses indicate a focus on optimising your existing residential portfolio while managing potential cashflow pressure. This aligns with the 'Refinance with Buffer Planning' segment, where clients seek both improved terms and strategic breathing room for future opportunities."
                },
                {
                    title: "Specific Challenges found in this type of cases",
                    content: [
                        "Timing refinance to avoid break costs while capturing better rates.",
                        "Balancing debt consolidation with maintaining borrowing capacity for future investments.",
                        "Aligning loan structure with potential future investment tax benefits."
                    ]
                },
                {
                    title: "The FINCO Approach",
                    content: "We typically explore strategy-level pathways such as education-led loan structuring to match your repayment comfort, sequencing of debt recycling where appropriate, and creating contractual buffers to manage rate variability. Any mention of taxation-related strategies, such as potential future investment tax benefits through debt segregation, is framed as a potential consideration only."
                },
                {
                    title: "Summary",
                    content: [
                        "Portfolio optimisation with a refinance-led strategy.",
                        "Cashflow management paired with strategic buffer creation.",
                        "Structure designed for both current comfort and future optionality."
                    ]
                }
            ];
            break;
            
        case 'COMMERCIAL':
            caseTitle = "# The Growth-Led Commercial Expansion Case";
            sections = [
                {
                    title: "What this means for you",
                    content: "Your scenario fits the 'Growth-Led' commercial segment, where business expansion or acquisition is the primary driver, accompanied by secondary timing or policy constraints. The dominant risk driver appears to be structure, ensuring the debt supports rather than hinders growth."
                },
                {
                    title: "Specific Challenges found in this type of cases",
                    content: [
                        "Aligning loan terms with irregular or project-based business cashflow.",
                        "Navigating lender policy for growth-focused ventures versus established cashflow.",
                        "Structuring debt to allow for future capital draws or staged acquisition."
                    ]
                },
                {
                    title: "The FINCO Approach",
                    content: "Likely pathways include exploring interest-only restructuring during intensive growth phases, creating cashflow buffers for volatility, detailed lender policy mapping to match your business model, and staged funding structures for phased projects."
                },
                {
                    title: "Summary",
                    content: [
                        "Debt structured as a growth engine, not just a facility.",
                        "Strategic buffer planning for cashflow variability.",
                        "Lender alignment focused on business trajectory, not just history."
                    ]
                }
            ];
            break;
            
        case 'SMSF':
            caseTitle = "# The SMSF Portfolio Alignment Case";
            sections = [
                {
                    title: "What this means for you",
                    content: "Your case aligns with the 'Acquisition & Cashflow Alignment' segment within SMSF lending. The primary focus is on integrating a new property acquisition or restructuring existing debt within the strict compliance framework of an SMSF, while aligning the repayments with the fund's contribution strategy."
                },
                {
                    title: "Specific Challenges found in this type of cases",
                    content: [
                        "Balancing LRBA (Limited Recourse Borrowing Arrangement) loan terms with the SMSF's illiquid asset structure.",
                        "Aligning repayment schedules with mandatory contribution flows and caps.",
                        "Ensuring all structuring is within ATO guidelines and lender-specific SMSF policies."
                    ]
                },
                {
                    title: "The FINCO Approach",
                    content: "We focus on LRBA structuring that considers the fund's liquidity, comparing interest-only versus principal & interest planning in the context of the member's retirement timeline, optimising refinance timing to avoid compliance pitfalls, and exploring compliance-safe restructuring to improve the fund's overall position."
                },
                {
                    title: "Summary",
                    content: [
                        "SMSF loan structure prioritising compliance and contribution alignment.",
                        "Repayment strategy integrated with the fund's long-term retirement objectives.",
                        "Proactive planning for regulatory and liquidity constraints."
                    ]
                }
            ];
            break;
    }
    
    // Add footer
    const footer = `
**Not just loan writers. Case solvers.**

*FINCO CAPITAL: Financial Confidence. Unlocked.*
`;
    
    return {
        caseTitle,
        sections,
        footer,
        refNumber,
        loanType
    };
}

function generateReferenceNumber() {
    const date = new Date().toISOString().slice(0, 10).replace(/-/g, '');
    const random = Math.random().toString(36).substring(2, 6).toUpperCase();
    return `REF-${date}-${random}`;
}

function renderResult(result) {
    const resultsContainer = document.querySelector('.results-container');
    const loanType = AppState.selectedLoanType;
    
    // Get color scheme based on loan type
    let colorScheme;
    switch(loanType) {
        case 'COMMERCIAL':
            colorScheme = {
                primaryBg: 'bg-[#FF9500]',
                primaryText: 'text-[#001A3D]',
                secondaryText: 'text-[#FFFFFF]',
                boldText: 'text-[#001A3D]'
            };
            break;
        case 'SMSF':
            colorScheme = {
                primaryBg: 'bg-[#656933]',
                primaryText: 'text-[#FF9500]',
                secondaryText: 'text-[#FFFFFF]',
                boldText: 'text-[#FF9500]'
            };
            break;
        case 'HOME':
        default:
            colorScheme = {
                primaryBg: 'bg-[#001A3D]',
                primaryText: 'text-[#FF9500]',
                secondaryText: 'text-[#FFFFFF]',
                boldText: 'text-[#FFFFFF]'
            };
            break;
    }
    
    // Build report HTML
    let reportHTML = `
        <div class="report-letterhead">
            <div class="finco-logo">
                <svg viewBox="0 0 500 150" class="finco-logo" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 30C20 20 80 15 80 15C80 15 140 20 140 30V80C140 110 80 140 80 140C80 140 20 110 20 80V30Z" fill="#001A3D" />
                    <path d="M25 35C25 28 80 20 80 20C80 20 135 28 135 35V80C135 105 80 135 80 135C80 135 25 105 25 80V35Z" stroke="#FF9500" stroke-width="3" />
                    <circle cx="80" cy="55" r="24" stroke="#FF9500" stroke-width="6" />
                    <rect x="76" y="75" width="8" height="48" fill="#FF9500" />
                    <rect x="84" y="98" width="14" height="6" fill="#FF9500" />
                    <rect x="84" y="112" width="14" height="6" fill="#FF9500" />
                    <text x="88" y="130" fill="#FF9500" style="font: 800 24px 'League Spartan', sans-serif">$</text>
                    <text x="80" y="63" text-anchor="middle" fill="#FF9500" style="font: bold 20px 'League Spartan', sans-serif; letter-spacing: -1px">FC</text>
                    <text x="170" y="85" fill="#001A3D" style="font: 800 78px 'League Spartan', sans-serif; letter-spacing: -4px">FINC<tspan fill="#FF9500">O</tspan></text>
                    <text x="170" y="122" fill="#001A3D" style="font: 700 24px 'League Spartan', sans-serif; letter-spacing: 10px; text-transform: uppercase">CAPITAL</text>
                </svg>
            </div>
            <div class="text-right">
                <p class="font-spartan font-bold text-finco-navy text-sm tracking-widest uppercase">Preliminary Strategic Analysis Report</p>
                <p class="text-slate-500 text-xs font-semibold font-spartan">${new Date().toLocaleDateString('en-GB', { dateStyle: 'full' })}</p>
                <p class="text-finco-orange font-mono text-sm font-bold">${result.refNumber}</p>
            </div>
        </div>
        
        <div class="report-content">
            <div class="report-header">
                <p class="report-header-tag">Strategic Classification</p>
                <h2 class="report-title">${result.caseTitle.replace('# ', '').replace('**', '').replace('**', '')}</h2>
                <p class="report-subtitle">A framework-based analysis of your unique lending scenario.</p>
                <p class="report-note">This report identifies strategic themes and potential pathways only. It does not assess suitability, appropriateness, or lender policy alignment, which can only be determined after a full fact-finding process.</p>
            </div>
            
            <div class="report-sections">
    `;
    
    // Add sections
    result.sections.forEach((section, index) => {
        const isFirstSection = index === 0;
        const sectionClass = isFirstSection ? `report-section ${colorScheme.primaryBg} border-none shadow-2xl` : 'report-section bg-white border-slate-100 shadow-sm';
        const titleClass = isFirstSection ? `section-title ${colorScheme.primaryText}` : 'section-title text-finco-navy';
        const contentClass = isFirstSection ? `section-content ${colorScheme.secondaryText} font-medium` : 'section-content text-slate-600';
        
        let contentHTML = '';
        if (Array.isArray(section.content)) {
            contentHTML = `
                <ul>
                    ${section.content.map(item => `
                        <li>
                            <span class="${isFirstSection ? colorScheme.primaryText : 'text-finco-navy'} mt-1">‚óè</span>
                            <span class="text-lg ${contentClass}">${formatBoldText(item, isFirstSection ? colorScheme.boldText : 'text-finco-navy')}</span>
                        </li>
                    `).join('')}
                </ul>
            `;
        } else {
            contentHTML = `<div class="text-lg leading-relaxed ${contentClass}">${formatBoldText(section.content, isFirstSection ? colorScheme.boldText : 'text-finco-navy')}</div>`;
        }
        
        reportHTML += `
            <div class="${sectionClass}">
                <h3 class="${titleClass}">${section.title}</h3>
                <div class="${contentClass}">
                    ${contentHTML}
                </div>
            </div>
        `;
    });
    
    // Add CTA section
    reportHTML += `
            <div class="section-cta">
                <h3 class="cta-title">Ready to take the next step?</h3>
                <div class="cta-content">
                    <p>This analysis identifies the pathways available to you.</p>
                    <p>For a bespoke assessment, please click the button below to book your Free Expert Strategy Session, or email us at <a href="mailto:service@fincocapital.com.au">service@fincocapital.com.au</a>.</p>
                    <p class="cta-emphasis">A copy of your personalised report will be emailed to you automatically when you book your Free Expert Strategy Session.</p>
                </div>
                <div class="reference-note">
                    <p class="reference-text">Quote Reference: ${result.refNumber}</p>
                </div>
            </div>
            
            <div class="disclaimer-section">
                <h4 class="disclaimer-title">Financial & Compliance Disclaimer</h4>
                <p class="disclaimer-text">The information provided by the FINCO Case Solver is for educational and strategic classification purposes only. It does not constitute financial advice, credit assistance, or a commitment to lend. All lending scenarios are subject to full assessment by a qualified FINCO CAPITAL Specialist Broker and the respective credit policies of potential lenders. We do not guarantee outcomes or specific interest rates based on this automated framework analysis.</p>
                <p class="disclaimer-footer">FINCO CAPITAL | AUSTRALIAN CREDIT REPRESENTATIVE NUMBER: 569933</p>
            </div>
        </div>
    `;
    
    resultsContainer.innerHTML = reportHTML;
}

function formatBoldText(text, boldClass = 'text-finco-navy font-extrabold') {
    if (!text) return text;
    
    // Simple bold formatting: **text** to <strong>text</strong>
    return text.replace(/\*\*(.*?)\*\*/g, `<strong class="${boldClass}">$1</strong>`);
}

// Prepare EmailJS Data for Case Solver Booking
function prepareEmailDataForCaseSolver(formData) {
    const result = AppState.result;
    const enquiryType = result.loanType === 'HOME' ? 'Home Loan Enquiry' : 
                       result.loanType === 'COMMERCIAL' ? 'Commercial Loan Enquiry' : 
                       'SMSF Loan Enquiry';
    
    return {
        enquiry_type: enquiryType,
        first_name: formData.fullName.split(' ')[0] || '',
        last_name: formData.fullName.split(' ').slice(1).join(' ') || '',
        mobile: formData.mobile,
        email: formData.email,
        preferred_contact_method: 'Call',
        best_time_to_reach: formData.preferredTime,
        financial_goal: formData.briefNote,
        appointment_time: formData.preferredTime,
        self_employed: 'No',
        multiple_properties: 'No',
        credit_issues: 'No',
        non_standard_security: 'No',
        multiple_applicants: 'No',
        urgent_settlement: 'No',
        home_enquiry_category: result.loanType === 'HOME' ? 'Case Solver Analysis' : 'N/A',
        property_state: 'VIC',
        property_value: 'Case Solver Analysis',
        loan_required: 'Case Solver Analysis',
        employment_type: 'N/A',
        uploaded_files: 'Case Solver Report: ' + result.refNumber,
        submitted_at: new Date().toLocaleString('en-AU', { 
            timeZone: 'Australia/Sydney',
            dateStyle: 'full',
            timeStyle: 'medium'
        }),
        additional_comments: formData.comments || '',
        report_reference: result.refNumber,
        case_title: result.caseTitle.replace('# ', ''),
        source: 'Case Solver Tool'
    };
}

// Send email via EmailJS for Case Solver
async function sendEmailViaEmailJS(formData) {
    try {
        // Show loading overlay
        emailLoading.style.display = 'flex';
        
        const templateParams = prepareEmailDataForCaseSolver(formData);
        
        console.log('Sending Case Solver email with data:', templateParams);
        
        // Send email using EmailJS
        const response = await emailjs.send(
            EMAILJS_CONFIG.SERVICE_ID,
            EMAILJS_CONFIG.TEMPLATE_ID,
            templateParams
        );
        
        console.log('Case Solver email sent successfully:', response);
        return { success: true, message: 'Email sent successfully!' };
        
    } catch (error) {
        console.error('Email sending failed:', error);
        return { 
            success: false, 
            message: `Failed to send email: ${error.text || error.message}` 
        };
    } finally {
        // Hide loading overlay
        emailLoading.style.display = 'none';
    }
}

async function handleDownloadPDF() {
    downloadPDF.disabled = true;
    downloadPDF.innerHTML = '<span class="btn-icon">‚è≥</span> Preparing...';
    
    try {
        const { jsPDF } = window.jspdf;
        const reportElement = document.querySelector('.results-container');
        
        if (!reportElement || !reportElement.innerHTML) {
            throw new Error('No report content found');
        }
        
        // Create a clone
        const clonedElement = reportElement.cloneNode(true);
        
        // Aggressive color enhancement function
        function applyVibrantStyles(element) {
            const classList = Array.from(element.classList || []);
            const computed = window.getComputedStyle(element);
            
            // Apply all computed styles first
            element.style.cssText = `
                color: ${computed.color} !important;
                background-color: ${computed.backgroundColor} !important;
                font-size: ${computed.fontSize} !important;
                font-weight: ${computed.fontWeight} !important;
                font-family: ${computed.fontFamily} !important;
                padding: ${computed.padding} !important;
                margin: ${computed.margin} !important;
                border: ${computed.border} !important;
                border-radius: ${computed.borderRadius} !important;
                line-height: ${computed.lineHeight} !important;
                text-align: ${computed.textAlign} !important;
                display: ${computed.display} !important;
                width: ${computed.width} !important;
                box-shadow: ${computed.boxShadow} !important;
                opacity: 1 !important;
            `;
            
            // Get background color for contrast check
            const bgColor = window.getComputedStyle(element).backgroundColor;
            const isLightBg = bgColor && !bgColor.includes('rgba(0') && !bgColor.includes('rgb(0, 0');
            
            // Override with explicit vibrant colors based on classes
            classList.forEach(cls => {
                if (cls.includes('FF9500') || cls.includes('orange')) {
                    element.style.backgroundColor = '#FF9500 !important';
                    element.style.color = '#FFFFFF !important'; // White text on orange
                }
                if (cls.includes('001A3D') || cls.includes('finco-navy') || cls.includes('navy')) {
                    element.style.backgroundColor = '#001A3D !important';
                    element.style.color = '#FFFFFF !important'; // White text on navy
                }
                if (cls.includes('656933') || cls.includes('green')) {
                    element.style.backgroundColor = '#656933 !important';
                    element.style.color = '#FFFFFF !important'; // White text on green
                }
                if (cls.includes('text-slate') || cls.includes('text-gray') || cls.includes('text-600')) {
                    element.style.color = '#1a1a1a !important'; // Dark text
                }
                if (cls.includes('bg-white') || cls.includes('white') || cls.includes('bg-slate-50')) {
                    element.style.backgroundColor = '#FFFFFF !important';
                    element.style.color = '#000000 !important'; // Dark text on white
                }
                if (cls.includes('text-white')) {
                    element.style.color = '#FFFFFF !important';
                }
            });
            
            // Force good contrast for all text elements
            if (['P', 'SPAN', 'LI', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'A'].includes(element.tagName)) {
                const currentBg = window.getComputedStyle(element).backgroundColor;
                // If background is light or transparent, use dark text
                if (!currentBg.includes('rgb(0') || currentBg.includes('rgba(255') || currentBg.includes('rgba(160')) {
                    element.style.color = '#000000 !important';
                }
            }
            
            // Recursively apply to children
            for (let child of element.children) {
                applyVibrantStyles(child);
            }
        }
        
        // Apply aggressive styling
        applyVibrantStyles(clonedElement);
        
        // Add to DOM with styling
        const tempDiv = document.createElement('div');
        tempDiv.style.cssText = `
            position: absolute;
            left: -10000px;
            top: -10000px;
            width: 1000px;
            background-color: #FFFFFF !important;
            padding: 20px;
            box-sizing: border-box;
        `;
        tempDiv.appendChild(clonedElement);
        document.body.appendChild(tempDiv);
        
        // Wait for styles to apply
        await new Promise(resolve => setTimeout(resolve, 600));
        
        // Capture with very high quality
        const canvas = await html2canvas(clonedElement, {
            allowTaint: true,
            useCORS: true,
            backgroundColor: '#ffffff',
            scale: 4,
            logging: false,
            width: 1000,
            windowWidth: 1000,
            windowHeight: clonedElement.scrollHeight,
            ignoreElements: (el) => {
                return el.classList && (el.classList.contains('results-actions') || el.classList.contains('action-button'));
            }
        });
        
        // Boost contrast, saturation and text clarity
        const ctx = canvas.getContext('2d');
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        // Enhance image with better saturation and contrast
        for (let i = 0; i < data.length; i += 4) {
            let r = data[i];
            let g = data[i + 1];
            let b = data[i + 2];
            const a = data[i + 3];
            
            // Convert to HSL for saturation boost
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const l = (max + min) / 2 / 255;
            
            // Increase saturation and contrast
            if (max !== min) {
                // Boost saturation by 40%
                const s = l < 0.5 ? (max - min) / (max + min) : (max - min) / (510 - max - min);
                const boostedS = Math.min(s * 1.4, 1);
                
                // Apply contrast enhancement
                const contrastMult = 1.35; // 35% contrast boost
                
                data[i] = Math.min(255, Math.max(0, (r - 128) * contrastMult + 128));
                data[i + 1] = Math.min(255, Math.max(0, (g - 128) * contrastMult + 128));
                data[i + 2] = Math.min(255, Math.max(0, (b - 128) * contrastMult + 128));
            } else {
                // For grays, apply contrast
                const contrastMult = 1.35;
                data[i] = Math.min(255, Math.max(0, (r - 128) * contrastMult + 128));
                data[i + 1] = Math.min(255, Math.max(0, (g - 128) * contrastMult + 128));
                data[i + 2] = Math.min(255, Math.max(0, (b - 128) * contrastMult + 128));
            }
            
            data[i + 3] = a;
        }
        
        ctx.putImageData(imageData, 0, 0);
        
        // Remove temp element
        document.body.removeChild(tempDiv);
        
        // Convert enhanced canvas to image
        const imgData = canvas.toDataURL('image/png');
        
        if (!imgData || imgData.length < 100) {
            throw new Error('Failed to capture content');
        }
        
        // Create PDF
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        
        const imgWidth = pageWidth;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        // Add image
        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
        
        // Add pages
        let heightLeft = imgHeight - pageHeight;
        let position = 0;
        
        while (heightLeft > 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }
        
        // Add footer
        const refNumber = AppState.result.refNumber;
        const pageCount = pdf.getNumberOfPages();
        pdf.setFontSize(9);
        pdf.setTextColor(0, 0, 0);
        
        for (let i = 1; i <= pageCount; i++) {
            pdf.setPage(i);
            pdf.text(
                `FINCO CAPITAL | Reference: ${refNumber} | Generated: ${new Date().toLocaleDateString()}`,
                pageWidth / 2,
                pageHeight - 4,
                { align: 'center' }
            );
        }
        
        // Save
        const fileName = `FINCO-Analysis-${refNumber}.pdf`;
        pdf.save(fileName);
        
        downloadPDF.disabled = false;
        downloadPDF.innerHTML = '<span class="btn-icon">üìÑ</span> Download Report (PDF)';
        
        console.log('PDF created with vibrant colors:', fileName);
        
    } catch (error) {
        console.error('PDF Error:', error);
        alert('Error: ' + error.message);
        downloadPDF.disabled = false;
        downloadPDF.innerHTML = '<span class="btn-icon">üìÑ</span> Download Report (PDF)';
    }
}

async function handleFormSubmit(e) {
    e.preventDefault();
    
    const formData = {
        fullName: document.getElementById('fullName').value,
        mobile: document.getElementById('mobile').value,
        email: document.getElementById('email').value,
        briefNote: document.getElementById('briefNote').value,
        comments: document.getElementById('comments').value,
        preferredTime: document.getElementById('preferredTime').value
    };
    
    // Store form data and send email directly
    AppState.bookingFormData = formData;
    
    // Send email directly
    try {
        const emailResult = await sendEmailViaEmailJS(formData);
        
        if (emailResult.success) {
            // Show success step
            formStep.classList.remove('active');
            successStep.classList.add('active');
            
            // Show success modal
            setTimeout(() => {
                emailSuccessModal.style.display = 'flex';
            }, 500);
            
            // Log for debugging
            console.log("Case Solver booking submitted successfully:", AppState.bookingFormData);
            console.log("Report Reference:", AppState.result.refNumber);
        } else {
            alert(`Failed to book session: ${emailResult.message}\nPlease try again or contact us directly.`);
        }
    } catch (error) {
        console.error('Error in form submission:', error);
        alert('An error occurred. Please try again.');
    }
}



function resetApp() {
    AppState.loanType = null;
    AppState.step = 0;
    AppState.answers = [];
    AppState.isProcessing = false;
    AppState.result = null;
    AppState.selectedLoanType = null;
    AppState.bookingFormData = null;
    
    showScreen('loanType');
    scrollToTop();
    
    // Reset modal if open
    sessionModal.classList.remove('active');
    formStep.classList.add('active');
    successStep.classList.remove('active');
    
    // Reset form
    if (bookingForm) {
        bookingForm.reset();
    }
}
</script>
<div id="footer-container"></div>
<script src="../js/load-components.js"></script>
<script src="../js/constants.js" defer></script>
<script src="../js/utils.js" defer></script>
<script src="../js/calculations.js" defer></script>
<script src="../js/home_extras.js" defer></script>
<script src="../js/eventListeners.js" defer></script>
</body>
</html>